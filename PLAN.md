# Trading 212 桌面插件 — 实现计划

## 1. 目标

- 不用每次打开 Trading 212 官方 App/网页，也能**快速看持仓、股价和收益**。
- 以「电脑上的小插件」形式存在，随时可看、尽量少打扰。

---

## 2. 形态选择：做哪种「插件」？

| 方案 | 是什么 | 优点 | 缺点 |
|------|--------|------|------|
| **A. Chrome 扩展** | 浏览器右上角图标，点开弹出小窗口 | 不装新软件、用浏览器即可；开发/分发简单 | 依赖 Chrome；需考虑 CORS，可能要配本地代理 |
| **B. 桌面小部件 / 系统托盘** | 独立桌面程序，可缩到托盘，点开小窗口 | 不依赖浏览器；可常驻、更像「桌面插件」 | 需要 Electron / Tauri / Python+GUI，体积和复杂度更大 |
| **C. 独立小网页 + 本地服务** | 浏览器打开 `localhost:xxx` 的一个页面 | 实现简单；不涉及扩展审核 | 需要先启动本地服务；没有「点一下图标就出来」的体验 |

**建议优先：A（Chrome 扩展）**

- 你说的「插件」和「不用每次打开那个软件」用「点一下浏览器图标就弹出」就能满足。
- 开发快、你本机加载扩展即可用，无需上架商店。
- 若以后想要「不依赖浏览器、系统托盘常驻」，再在现有 API 封装基础上加一个 B 方案（例如 Electron 小窗）即可。

---

## 3. 技术前提：Trading 212 API

- **文档**：<https://docs.trading212.com/>
- **认证**：HTTP Basic，`API Key` + `API Secret`（在 App 里：设置 → API (Beta) 生成）。
- **环境**：
  - 实盘：`https://live.trading212.com/api/v0`
  - 模拟：`https://demo.trading212.com/api/v0`
- **我们主要用到的接口**：
  - `GET /equity/account/summary` — 账户摘要（现金、投资总值、已实现/未实现盈亏）
  - `GET /equity/positions` — 当前持仓（数量、均价、现价、未实现盈亏）
- **限制**：仅 Invest / Stocks ISA 账户；有频率限制（如 positions 约 1 次/秒）；密钥需妥善保存。

---

## 4. 核心问题：CORS

- 前端（Chrome 扩展的 popup/options）直接请求 `live.trading212.com` / `demo.trading212.com` 时，可能被**跨域策略（CORS）**拦截。
- **应对**：
  - **方案甲**：扩展里先**直接请求 Trading 212**；若在你这边的环境中不报 CORS，就无需代理。
  - **方案乙**：若出现 CORS 错误，则加一个**本地代理**：浏览器只请求 `http://127.0.0.1:8765`，由本机上的一个小服务（如 Python Flask）转发到 Trading 212，并在服务端带上 API Key/Secret（密钥不放在扩展里，更安全）。

计划里**先按「扩展直连」实现**，同时**预留「使用本地代理」的配置**；若你实际使用时遇到 CORS，再启用代理即可。

---

## 5. 功能范围（第一版）

- **配置**（options 页面）：
  - API Key、API Secret（若用代理，可改为「代理已带密钥」、仅填代理地址）。
  - 环境：Demo / Live。
  - 可选：是否使用本地代理 + 代理地址（如 `http://127.0.0.1:8765`）。
- **弹窗（popup）**：
  - 账户摘要：总资产、可用现金、投资市值、已实现/未实现盈亏。
  - 持仓列表：股票名、代码、数量、现价、成本、未实现盈亏（金额/百分比）。
  - 手动刷新按钮；可选：自动刷新间隔（如 30 秒）。
- **不做**：下单、改单、历史订单列表等（仅只读查看）。

---

## 6. 实现步骤（可执行顺序）

1. **项目结构**
   - `extension/`：Chrome 扩展（manifest v3、popup、options、icons）。
   - `proxy/`（可选）：本地代理服务（如 Python + Flask），用于解决 CORS 或把密钥放在本机。

2. **扩展基础**
   - `manifest.json`：权限（storage、host_permissions 含 Trading 212 与 localhost）。
   - options 页：保存/读取 API Key、API Secret、环境、是否代理、代理 URL。
   - popup 页：布局与样式；占位文案「未配置 / 加载中 / 错误」。

3. **API 层**
   - 封装：`getAccountSummary()`、`getPositions()`；根据配置选择「直连」或「走代理」。
   - 认证：直连时在扩展内用 Basic 头；走代理时由代理加认证。

4. **弹窗数据与 UI**
   - 调用上述 API，展示账户摘要 + 持仓列表；错误时友好提示（如「请检查 API 或代理」）。
   - 刷新按钮；可选自动刷新（节流，避免触发 API 限频）。

5. **本地代理（按需）**
   - 若你遇到 CORS：提供 `proxy/app.py` + `requirements.txt`，启动后扩展切到「使用代理」并填 `http://127.0.0.1:8765`。
   - 代理从环境变量或本地配置文件读 API Key/Secret，转发到 Trading 212。

6. **文档与使用**
   - README：如何获取 API Key、如何加载扩展、如何（可选）启动代理、如何配置选项。

---

## 7. 总结

- **形态**：先做 **Chrome 扩展**，实现「点图标 → 弹窗看持仓与收益」。
- **数据来源**：Trading 212 官方 API（已确认可用）。
- **CORS**：优先扩展直连；不行就加本地代理，扩展侧已预留配置。
- **第一版只做只读**：账户摘要 + 持仓 + 收益展示，不做交易。

如果你认可这个方向，下一步就按这个计划在现有仓库里实现：先完成扩展的 manifest/options/popup 和 API 封装，再视需要补代理与 README。
