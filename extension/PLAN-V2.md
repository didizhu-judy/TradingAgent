# Trading 212 扩展 — 体验与专业度提升计划 V2

## 1. 背景透明度调节（可见、好用）

- **问题**：用户找不到透明度调节入口。
- **做法**：
  - 在选项页顶部增加 **「外观 / Appearance」** 区块，内含 **「背景透明度 / Background opacity」** 滑块（0.5～1），并显示当前百分比。
  - 文案明确说明「调节 popup、侧边栏、悬浮窗的整体背景透明度」。
  - 保存后立即生效（popup/侧边栏/悬浮窗通过 CSS 变量 `--app-opacity` 应用）。

## 2. 悬浮窗点击无反应

- **问题**：点击「在页面打开悬浮窗」没有反应。
- **原因**：当前依赖点击时临时注入 content script；在部分页面注入失败或消息未送达。
- **做法**：
  - 在 manifest 中注册 **content_scripts**，对 `https://*/*`、`http://*/*` 在 `document_idle` 注入 `content.js`，使监听器常驻。
  - Popup 侧只发 `chrome.tabs.sendMessage(tabId, { type: 'T212_SHOW_FLOATING' })`，不再先执行 `executeScript`。
  - 若当前页不可用（如 chrome://），捕获错误并提示「请在普通网页中打开悬浮窗」。

## 3. 侧边栏自适应布局（不设固定宽度）

- **问题**：侧边栏宽度调节体验差；应随用户拖拽宽度自适应。
- **做法**：
  - 移除选项里的「侧边栏最小宽度」配置（Chrome 侧栏宽度本身不可程序控制）。
  - 用 **纯 CSS 自适应**：flex、grid、min-width 仅保证可读性，不写死宽度；窄屏单列/紧凑，宽屏可多列或更宽松。
  - 使用媒体查询或 container queries 让卡片、表格、Tab 随宽度变化（换行、字号、间距等）。

## 4. 中英文语言支持（i18n）

- **做法**：
  - 新增 `_locales/zh_CN/messages.json`、`_locales/en/messages.json`，或使用简单 JS 字典 + 存储的语言偏好。
  - 选项页提供「语言 / Language」：中文 / English。
  - 所有界面文案通过统一接口取（如 `t('key')`），popup、侧边栏、悬浮窗、选项页一致。

## 5. UI 现代化（参考 quant / fintech）

- **目标**：摆脱「老套」感，贴近现代量化/金融科技仪表盘。
- **做法**：
  - **层次**：卡片使用轻微 backdrop-filter、细边框、统一圆角与阴影。
  - **数据密度**：数字等宽、对齐；表格/列表紧凑但留白合理。
  - **配色**：深色底 + 单一强调色（如青/蓝绿），盈亏绿/红清晰区分。
  - **字体**：无衬线主字体 + 等宽数字，标题字重与字间距略加强。
  - 参考：Dribbble trading dashboard、Hedge UI、glassmorphism 在 fintech 中的克制使用。

## 6. 验收标准

- 选项页打开即可看到「外观」区块和「背景透明度」滑块，调节后保存，popup/侧边栏/悬浮窗背景透明度随之变化。
- 在任意普通网页点击「在页面打开悬浮窗」，悬浮窗稳定出现；在 chrome:// 等页有友好提示。
- 侧边栏随用户拖拽变宽/变窄时，布局自适应，无横向溢出、无「固定宽度」导致的割裂感。
- 可切换中/英，所有主要界面文案随语言切换。
- 整体观感符合现代 quant/fintech 风格，专业、清晰、不过时。
